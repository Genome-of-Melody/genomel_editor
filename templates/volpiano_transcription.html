<div id="volpiano_transcription">
    <div id="volpiano_transcription_result">
{#        Here be the result of the transcription. The purpose of this field#}
{#        is to provide feedback: how does the current transcription look like?#}
    </div>
    <div id="volpiano_transcription_input">
{#        Here be the input field where the user edits the volpiano string.#}
        {# The important part is the form, which triggers updates to the Melody #}
        {# object in the database. #}
        <form action="{% url 'GenomelEditor:save_annotation' %}" method="post">

            {% csrf_token %}

            <label for="volpiano_transcription_volpiano_input">Volpiano</label>
            <input id="volpiano_transcription_volpiano_input"
                   type="text"
                   name="volpiano"
                   size="{{ melody.volpiano|length|add:"120" }}"
                   value="{{ melody.volpiano }}">
            <br>
            <label for="volpiano_transcription_syllabized_text_input">Syllabized text</label>
            <input id="volpiano_transcription_syllabized_text_input"
                   type="text"
                   name="syllabized_text"
                   size="{{ melody.syllabized_text|length|add:"40" }}"
                   value="{{ melody.syllabized_text }}">
            <br>
            <label for="volpiano_transcription_is_adiastematic">Is adiastematic?</label>
            <input id="volpiano_transcription_is_adiastematic"
                   type="checkbox"
                   name="is_adiastematic"
                   value="{{ melody.is_adiastematic }}">
            <br>
            <label for="volpiano_transcription_is_incomplete_in_source">Is incomplete in source?</label>
            <input id="volpiano_transcription_is_incomplete_in_source"
                   type="checkbox"
                   name="is_incomplete_in_source"
                   value="{{ melody.is_incomplete_in_source }}">
            <br><br>

            <!-- State management. -->
            {% if melody.is_in_transcription %}
                <label for="volpiano_transcription_is_transcribed">Is transcribed?</label>
                <input id="volpiano_transcription_is_transcribed"
                       type="checkbox"
                       name="is_transcribed"
                       value=true
                       {% if melody.show_as_transcribed %} checked {% endif %}
                >
            {% else %}
                <!-- TODO: see if user has permission to check?
                     At this point, the user should always have the permission to check,
                     because a melody that is already transcribed and requires checking
                     should never be selected for a user who does *not* have checking permissions.-->
                <label for="volpiano_transcription_is_checked">Can be finalized?</label>
                <input id="volpiano_transcription_is_checked"
                       type="checkbox"
                       name="is_checked"
                       value=true
                       {% if melody.show_as_checked %} checked {% endif %}
                >
            {% endif %}

            <input type="hidden" value="{{ chant.id }}" name="chant_id">
            <input type="hidden" value="{{ melody.id|default_if_none:"" }}" name="melody_id">
{#          <input type="hidden" value="{{ melody.timestamp }}" name="melody_timestamp">#}

            <input type="submit" value="Save">
        </form>
    </div>
</div>